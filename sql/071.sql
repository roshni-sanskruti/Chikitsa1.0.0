ALTER TABLE %dbprefix%patient ADD blood_group VARCHAR(3) NULL ;
CREATE OR REPLACE VIEW %dbprefix%view_tax_report AS select patient.display_id AS display_id,patient.first_name AS first_name,patient.middle_name AS middle_name,patient.last_name AS last_name,bill.bill_id AS bill_id,bill.bill_date AS bill_date,(SELECT SUM(IFNULL(bill_detail_tax.amount,0)) FROM %dbprefix%bill_detail bill_detail_tax WHERE bill_detail_tax.bill_id = bill.bill_id and ifnull(bill_detail_tax.tax_amount,0) > 0) AS taxable_amount,(SELECT SUM(IFNULL(bill_detail_non.amount,0)) FROM %dbprefix%bill_detail bill_detail_non WHERE bill_detail_non.bill_id = bill.bill_id and ifnull(bill_detail_non.tax_amount,0) = 0 and bill_detail_non.type != 'discount') AS non_taxable_amount,(SELECT SUM(IFNULL(bill_detail_discount.amount,0)) FROM %dbprefix%bill_detail bill_detail_discount WHERE bill_detail_discount.bill_id = bill.bill_id and bill_detail_discount.type = 'discount') AS discount,bill.tax_amount AS item_tax_amount,bill.total_amount AS total_amount from %dbprefix%bill bill  join %dbprefix%view_patient patient on patient.patient_id = bill.patient_id;
CREATE OR REPLACE VIEW %dbprefix%view_patient AS SELECT patient.patient_id,patient.blood_group,patient.clinic_id,patient.patient_since, patient.age,patient.display_id,patient.gender,patient.dob, patient.reference_by, patient.followup_date,(SELECT IFNULL(SUM(IFNULL(patient_account.adjust_amount,0)),0) FROM %dbprefix%patient_account AS patient_account WHERE patient_account.patient_id = patient.patient_id AND payment_id IS NOT NULL) - (SELECT IFNULL(SUM(IFNULL(patient_account.adjust_amount,0)),0) FROM %dbprefix%patient_account AS patient_account WHERE patient_account.patient_id = patient.patient_id AND bill_id IS NOT NULL) AS in_account_amount,contacts.display_name,contacts.contact_id,contacts.first_name,contacts.middle_name,contacts.last_name,(SELECT contact_details.detail FROM %dbprefix%contact_details as contact_details WHERE contact_details.contact_id = contacts.contact_id AND contact_details.type='mobile' LIMIT 1) AS phone_number,	   contacts.email   FROM %dbprefix%patient as patient        LEFT JOIN %dbprefix%contacts as contacts ON patient.contact_id = contacts.contact_id;
UPDATE %dbprefix%version SET current_version='0.7.1';