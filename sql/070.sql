UPDATE %dbprefix%clinic SET clinic_logo = CONCAT('uploads/',clinic_logo) WHERE clinic_logo IS NOT NULL;
UPDATE %dbprefix%contacts SET contact_image = CONCAT('uploads/',contact_image) WHERE IFNULL(contact_image,"") != "";
CREATE OR REPLACE VIEW %dbprefix%view_patient AS SELECT patient.patient_id AS patient_id, patient.clinic_id AS clinic_id,  patient.clinic_code AS clinic_code,  patient.patient_since AS patient_since, patient.age AS age,  patient.display_id AS display_id,  patient.gender AS gender,  patient.dob AS dob,  patient.reference_by AS reference_by,  patient.reference_by_detail AS reference_by_detail,patient.followup_date AS followup_date,((select ifnull(sum(ifnull(patient_account.adjust_amount,0)),0) from %dbprefix%patient_account patient_account where ((patient_account.patient_id = patient.patient_id) and (patient_account.payment_id is not null))) - (select ifnull(sum(ifnull(patient_account.adjust_amount,0)),0) from %dbprefix%patient_account patient_account where ((patient_account.patient_id = patient.patient_id) and (patient_account.bill_id is not null)))) AS in_account_amount,contacts.display_name AS display_name,contacts.contact_id AS contact_id,contacts.first_name AS first_name,contacts.middle_name AS middle_name,contacts.last_name AS last_name,(select contact_details.detail from %dbprefix%contact_details contact_details where ((contact_details.contact_id = contacts.contact_id) and (contact_details.type = 'mobile')) limit 1) AS phone_number,contacts.email AS email from (%dbprefix%patient patient left join %dbprefix%contacts contacts on((patient.contact_id = contacts.contact_id))) ;
UPDATE %dbprefix%version SET current_version='0.7.0';