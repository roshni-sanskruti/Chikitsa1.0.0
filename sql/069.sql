ALTER TABLE %dbprefix%receipt_template CHANGE template template TEXT CHARACTER SET utf8 COLLATE utf8_bin NOT NULL;
ALTER TABLE %dbprefix%clinic CHANGE clinic_name clinic_name VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
ALTER TABLE %dbprefix%clinic CHANGE tag_line tag_line VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
ALTER TABLE %dbprefix%bill_detail CHANGE particular particular VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
ALTER TABLE %dbprefix%patient ADD reference_by_detail VARCHAR(250) NULL AFTER reference_by;
CREATE OR REPLACE VIEW %dbprefix%view_visit AS select visit.visit_id AS visit_id,visit.visit_date AS visit_date,visit.visit_time AS visit_time,visit.type AS type,visit.notes AS notes,visit.patient_notes AS patient_notes,visit.doctor_id AS doctor_id,doctor.name AS name,visit.patient_id AS patient_id,bill.bill_id AS bill_id,bill.total_amount AS total_amount,(SELECT IFNULL(SUM(IFNULL(bill_detail.amount,0)),0) FROM %dbprefix%bill_detail AS bill_detail WHERE bill_detail.bill_id = bill.bill_id AND bill_detail.type='tax') AS bill_tax_amount,(SELECT SUM(item_bill_detail.tax_amount) FROM %dbprefix%bill_detail AS item_bill_detail WHERE item_bill_detail.bill_id = bill.bill_id)AS item_tax_amount,bill.due_amount AS due_amount from %dbprefix%visit visit join %dbprefix%view_doctor doctor on doctor.doctor_id = visit.doctor_id join %dbprefix%bill bill on bill.visit_id = visit.visit_id order by visit.patient_id,visit.visit_date,visit.visit_time;
UPDATE %dbprefix%version SET current_version='0.6.9';